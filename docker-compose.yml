version: "3"
services:

  mysql-master:
    image: mysql:5.7.22
    command: sh -c "cp /usr/share/zoneinfo/Japan /etc/localtime && /usr/local/bin/docker-entrypoint.sh mysqld"
    ports:
      - 13306:3306
    environment:
      MYSQL_DATABASE: db0
      MYSQL_ROOT_PASSWORD: root
      MYSQL_USER: test
      MYSQL_PASSWORD: test
    volumes:
      - ./docker-volumes/mysql/master/conf.d:/etc/mysql/conf.d
      - ./docker-volumes/mysql/master/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d
      - ./docker-volumes/mysql/master/slow-log:/var/log/mysql/slow-log

  mysql-slave:
    depends_on:
      - mysql-master
    image: mysql:5.7.22
    command: sh -c "cp /usr/share/zoneinfo/Japan /etc/localtime && /usr/local/bin/docker-entrypoint.sh mysqld"
    ports:
      - 23306:3306
    environment:
      MYSQL_DATABASE: db0
      MYSQL_ROOT_PASSWORD: root
      # This user will be generated by replication
      # MYSQL_USER: test
      # MYSQL_PASSWORD: test
    volumes:
      - ./docker-volumes/mysql/slave/conf.d:/etc/mysql/conf.d
      - ./docker-volumes/mysql/slave/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d
      - ./docker-volumes/mysql/slave/slow-log:/var/log/mysql/slow-log
